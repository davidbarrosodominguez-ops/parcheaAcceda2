# 08_seguridad.yml - PKI, sudoers, security checks

    - name: pkis pem x509
      shell: find  /etc/pki/ /etc/pki/ca-trust/ -name "*.pem" -exec sh -c 'echo dbd{}dbd && openssl x509 -in {} -noout -text ' \;| sed 's/dbd/<br>/g'
      register: pkix509
      ignore_errors: True

    - name: pkis pem x509
      shell: find  /etc/pki/ /etc/pki/ca-trust/ -name "*.crt" -exec sh -c 'echo dbd{}dbd && openssl x509 -in {} -noout -text ' \;| sed 's/dbd/<br>/g'
      register: pkiCRTx509
      ignore_errors: True

    - name: usuarios de sistema
      shell: echo -e "$(awk -F':' '{print $1}' /etc/passwd|while read NODE RESTO ; do id $NODE;done)"
      register: homeusers

    - name: sudo
      shell: visudo -c | grep -i sudo && echo '<hr>' && grep wheel /etc/group
      register: sudoers
      ignore_errors: True


    - name: Leer fichero /etc/fstab
      ansible.builtin.slurp:
        src: /etc/fstab
      register: slurp_etc_fstab

    - name: Preparar salida de fstab para reporte
      ansible.builtin.set_fact:
        etcfstab:
          stdout: "{{ slurp_etc_fstab.content | b64decode }}"

    - name: Fichero config
      shell: ls -ltra /opt/wildfly-10.1.0.Final/standalone/configuration/ || echo -e '<p style=color:red;>⚠️ ⚠️ REVISAR_⚠️ ⚠️ SIN CONFIGURACIÓN Fichero config _REVISAR</p>'
      register: etcconfigini
      ignore_errors: True

    - name: configuracion de dominio
      shell: realm list |grep ':' || echo -e '<p style=color:red;>⚠️ ⚠️ REVISAR_⚠️ ⚠️ SIN CONFIGURACIÓN REALMD _REVISAR</p>'
      register: realmlist

    - name: Fichero config dominio
      command: cat -A /etc/sssd/sssd.conf
      register: fichsssd
      ignore_errors: True

