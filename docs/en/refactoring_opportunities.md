# Refactoring Opportunities

This document details areas for improvement identified in the current code to facilitate maintenance, readability, and robustness.

## 1. Eliminating Duplication
**Issue**: There is almost total duplication between the `sgadprevio` role and the `playbooks/rhel_SGADprevioAcceda2.yml` playbook.
**Recommended Action**: Delete or archive `playbooks/rhel_SGADprevioAcceda2.yml`. Use `sgadprevio.yml` exclusively, invoking the role.

## 2. Path and Variable Management
**Issue**: Many paths are hardcoded (e.g., `/home/reexus/...`, `/opt/...`).
**Recommended Action**:
- Move all paths to variables in `defaults/main.yml` or `vars/main.yml`.
- Use relative paths or inventory variables where possible.

## 3. Ansible Modules vs Shell Usage
**Issue**: Extensive use of `shell` and `command` modules with complex pipes (`| grep | awk ...`) for tasks that Ansible can handle natively.
**Recommended Action**:
- Use `yum`/`package` module to list updates.
- Use `service`/`systemd_service` module to check services.
- Use `mount` module to check mounts.
- This makes the code more idempotent and less fragile to Linux command output changes.

## 4. Error Handling
**Issue**: Frequent use of `ignore_errors: True` to handle `shell` command failures. This can mask real problems.
**Recommended Action**: Implement more robust checks (`failed_when`, `changed_when`) and `block/rescue` blocks if necessary.

## 5. Delegation
**Issue**: Delegation to host `adgesasateinfc2` is written directly in tasks (`delegate_to: adgesasateinfc2`).
**Recommended Action**: Define the management host as a variable (e.g., `delegate_to: "{{ reporting_host }}"`) to allow easy changing from the inventory.

## 6. HTML Generation
**Issue**: Part of the HTML is generated by concatenating strings in `shell` and `echo` commands.
**Recommended Action**: Move all presentation logic to Jinja2 templates (`templates/`) to separate data from presentation.
